<!DOCTYPE html>
<html>

<head>
  <title>Earthdata Research</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5.21.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>
</head>

<body>
  <div id="vis0"></div>
  <div id="vis1"></div>
  <div id="vis2"></div>
  <div id="vis3"></div>

  <script type="text/javascript">
    var v0 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 1500,
      "height": 400,
      "autosize": { "type": "fit", "contains": "padding" },
      "description": "A simple bar chart with embedded data.",
      "data": {
        "url": "https://raw.githubusercontent.com/vinnyinverso/earthdata-research/main/article_db.csv"
      },
      "mark": { "type": "line", "tooltip": true },
      "encoding": {
        "tooltip": [
          { "aggregate": "distinct", "type": "quantitative", "field": "pub_doi" }
        ],
        "x": { "field": "pub_year", "type": "temporal" },
        "y": { "aggregate": "distinct", "field": "pub_doi" }
      },
      "transform": [
        { "filter": { "timeUnit": "year", "field": "pub_year", "gte": "1998" } }
      ]
    };
    vegaEmbed('#vis0', v0);

    var v1 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 1500,
      "height": 500,
      "layer": [
        {
          "data": {
            "url": "https://raw.githubusercontent.com/vinnyinverso/earthdata-research/main/world-110m.json",
            "format": { "type": "topojson", "feature": "countries" }
          },
          "mark": { "type": "geoshape", "fill": "lightgray", "stroke": "gray" }
        },
        {
          "data": {
            "url": "https://raw.githubusercontent.com/vinnyinverso/earthdata-research/main/locations.csv"
          },
          "projection": {
            "type": "equalEarth"
          },
          "mark": {
            "type": "circle",
            "size": 10,
            "color": "steelblue"
          },
          "encoding": {
            "tooltip": [
              { "field": "latitude", "type": "quantitative" },
              { "field": "longitude", "type": "quantitative" }
            ],
            "longitude": {
              "field": "longitude",
              "type": "quantitative"
            },
            "latitude": {
              "field": "latitude",
              "type": "quantitative"
            }
          }
        }
      ]
    };
    vegaEmbed('#vis1', v1);

    var v2 = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": 1500,
      "height": 500,
      "title": "Datsets per Publication per Year",
      "data": {
        "url": "https://raw.githubusercontent.com/vinnyinverso/earthdata-research/main/article_db.csv"
      },
      "transform": [
        {
          "aggregate": [
            {
              "op": "distinct",
              "field": "pub_doi",
              "as": "distinct_pub_doi"
            },
            {
              "op": "count",
              "field": "ds_doi",
              "as": "count_ds_doi"
            }
          ],
          "groupby": ["pub_year"]
        },
        { "calculate": "datum.count_ds_doi / datum.distinct_pub_doi", "as": "Mean Datasets Per Publication" }

      ],
      "layer": [
        {
          "mark": { "type": "square", "size": 200 },
          "encoding": {
            "x": { "field": "pub_year", "type": "temporal" },
            "y": { "field": "Mean Datasets Per Publication", "type": "quantitative" }
          }
        },
      ],
    };
    vegaEmbed('#vis2', v2);

    var v3 = {
      "data": {"url": "https://raw.githubusercontent.com/vinnyinverso/earthdata-research/main/article_db.csv"},
      "mark": "bar",
      "width": 1300,
      "height": 500,
      "encoding": {
        "x": {"type": "quantitative", "field": "count"},
        "y": {"type": "nominal", "field": "ds_title", "sort": {"field": "count", "order": "descending" }}
      },
      "transform": [
        {
          "aggregate": [
            {"op": "count", "field": "ds_doi", "as": "count"}
          ],
          "groupby": ["ds_title"]
        },
        {
          "window": [{"op": "row_number", "field": "", "as": "rank"}],
          "sort": [{"field": "count", "order": "descending"}]
        },
        {"filter": "datum.rank < 10"},
        {"filter": "datum.ds_title != ''"}
      ],
      "$schema": "https://vega.github.io/schema/vega-lite/v3.2.1.json"
    };

    vegaEmbed('#vis3', v3);
  </script>
</body>

</html>